{% extends 'base.html' %}
{% from 'bootstrap5/form.html' import render_field, render_form %}
{% from 'macros.html' import show_flashed_messages %}

{% block basecontent %}
    <div class="basicContainer">

        <h1>{{ form.name.data }}</h1>

        {{ show_flashed_messages() }}

        <form action="/group/{{ form.id.data }}" method="POST" class="needs-validation" novalidate>
            {{ form.csrf_token }}
            {{ render_field(form.id) }}
            <div class="row">
                <div class="col">
                    {{ render_field(form.name, placeholder="Gruppenname") }}
                </div>

                <div class="col">
                    {{ render_field(form.owner) }}
                </div>

                <div class="col">
                    {{ render_field(form.creation_time) }}
                </div>
            </div>

            <div class="row">
                <div class="col">
                    {{ render_field(form.description) }}
                </div>
            </div>

            {% if current_user.id == form.owner.id %}
                <div id="loginFormButtonBar">
                    <button type="submit" class="btn btn-primary">Best√§tigen</button>
                    <a href="/group/{{ form.id.data }}">
                        <button type="button" class="btn btn-secondary">Verwerfen</button>
                    </a>
                </div>
            {% endif %}
        </form>

        {% if member %}

            <h2 class="mt-3">Mitglieder</h2>

            <div class="basicContainer secondaryContainer groupMemberListContainer">
                {% for user in member %}
                    <div class="basicContainer secondaryContainer groupMemberContainer">
                        <div class="groupMemberText">{{ user.firstname }} {{ user.lastname }} ({{ user.username }}) Beigetreten am: {{ user.joiningdate | datetime }}</div>

                        {% if user.id != current_user.id and current_user.id == form.owner.id %}

                            <form action="/group/{{ form.id.data }}/member/{{ user.id }}" method="POST" class="removeUserFromGroupForm">
                                {{ form.csrf_token }}
                                <input type="text" name="reason" id="reason" placeholder="Grund" class="form-control form-control-sm" required>
                                <button type="submit" class="btn btn-danger btn-sm">Entfernen</button>
                            </form>

                        {% elif current_user.id == user.id %}

                            <form action="/group/{{ form.id.data }}/member/{{ user.id }}" method="POST" class="removeUserFromGroupForm">
                                <button type="button" class="btn btn-danger btn-sm" onclick="confirmLeave(this)">Verlassen</button>
                            </form>

                        {% endif %}
                    </div>
                {% endfor %}
            </div>

        {% endif %}
    </div>
    <script src="{{ url_for('static', filename='js/groupFunctions.js') }}"></script>
{% endblock %}